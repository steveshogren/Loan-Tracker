<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <script type="text/javascript" src="html/jquery.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $('img.delete').bind('click', function(){
                if (confirm('Do you really want to delete this loan?')) {
                    $(this).closest('tr').animate({ height: 'hide', opacity: 'hide' }, 'slow');
                    $.post("deleteLoan.php", {loanId: $(this).closest('td').attr("id")},
                            function(xml) {
                                $("#cdg_m").animate({ height: $("marginLevel", xml).text()}, 'slow');
                                $("#cdg_h2").html("Payoff Percentage: " + $("percentPaid", xml).text() + "%");
                            }
                    );
                }
            });
            
            $("input[class=input_new_amount], input[class=input_name], input[class=input_new_interest]").focus(function(){
                if (this.defaultValue == this.value) {
                    $(this).val('');
                }
            });

            $("input[class=input_amount], input[class=input_interest]").focus(function(){
                if (this.defaultValue == this.value) {
                    $(this).select();
                }
            });

            $("input[class=input_new_amount], input[class=input_name], input[class=input_new_interest]").focusout(function(){
                if (this.value == '') {
                    $(this).val(this.defaultValue);
                }
            });

        });
    </script>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
    <title>Break These Chains</title>
    <link href="html/stylesheet.css" rel="stylesheet" type="text/css" media="screen"/>
</head>

<body>
<div class="main">
<div class="header">
    <div class="header-top">
        <span class="sitename">Break These Chains</span>
        <div class="login-bg">
            <form action="index.php" method="post" name="logout">
                <a href='index.php?logout=true' class="white-link">Logout</a>
            </form>
        </div>
    </div>
    <div class="header-bottom">
        <div id="navcontainer">
            <ul class="navlist">
                <li class="active"><a href="index.php">Home</a></li>
                <li class=""><a href="about.php">About</a></li>
            </ul>
        </div>
    </div>
</div>
<div class="body-main">
<div class="body-bottom">
<div class="tables">

<?php
    $displayLoans = false;
    foreach ($Loans as $Loan) {
        if ($Loan->getId()) {
            $displayLoans = true;
        }
    }
?>
<table class="table">
    <?php if ($displayLoans) : ?>
            <tr>
            <th>Loan Name</th>
            <th>%</th>
            <th class="table_interest_head">Interest</th>
            <th>Amount</th>
            <th>Max</th>
            </tr>
    <?php endif; ?>
    <?php foreach ($Loans as $Loan):
        $totalLoanAmount += $Loan->getAmount();
        $totalLoanMaxAmount += $Loan->getMaxAmount();
        if ($Loan->getId()):
            $submitButtonText = 'Update';
            $percentBarPx = (-120 - ($Loan->getPercentPaid()*-120)/100)+1;
    ?>

    <tr>
        <form action="index.php" method="post" name="<?php echo $Loan->getId();?>">
            <input type="hidden" name="loanId" value="<?php echo $Loan->getId();?>">
            <td class="tabletext">
                <input class="input_name" type="text" name="name" value="<?php echo $Loan->getName();?>">

            </td>
            <td class="tabletext">
                <img src="html/images/percentImage.png" alt="sup?" class="percentImage" style="background-position: <?php echo $percentBarPx; ?>px 0pt;"/>
            </td>
            <td class="table_interest">
                <input class="input_interest" type="text" name="interest" value="<?php echo $Loan->getInterest();?>">
            </td>
            <td class="tabletext">
                <input class="input_amount" type="text" name="amount" value="<?php echo $Loan->getAmount();?>">
            </td>
            <td class="table_max_amount_text">
                <?php echo number_format($Loan->getMaxAmount())?>
            </td>
            <td class="tabletext">
                <input type="submit" name="Submit" value="<?php echo $submitButtonText;?>">
            </td>
            <td class="tabletext" id="<?php echo $Loan->getId();?>" >
                <img class="delete" src="html/images/Xion18x18.gif"  alt="Angry face" name="delete" value="delete" />
            </td>
        </form>
    </tr>
    <?php endif;?>
</table>
    <table class="table">
    <?php endforeach; ?>
    <th>Create a New Loan</th>
    <?php
        foreach ($Loans as $Loan) :
        if (! $Loan->getId()) :
            $submitButtonText = 'Create';
    ?>

    <tr>
        <form action="index.php" method="post" name="<?php echo $Loan->getId();?>">
            <input type="hidden" name="loanId" value="<?php echo $Loan->getId();?>">
            <td class="tabletext">
                <input class="input_name" type="text" name="name"
                                         value="<?php echo $Loan->getName();?>">
            </td>
            <td class="tabletext">
                <input class="input_new_interest" type="text" name="interest"
                                         value="<?php echo $Loan->getInterest();?>">
            </td>
            <td class="tabletext">
                <input class="input_new_amount" type="text" name="amount"
                                         value="<?php echo $Loan->getAmount();?>">
            </td>
            <td class="tabletext">
                <input class="input_new_amount" type="text" name="max_amount"
                                         value="<?php echo $Loan->getMaxAmount();?>">
            </td>
            <td class="tabletext">
                <input type="submit" name="Submit" value="<?php echo $submitButtonText;?>">
            </td>
            <td class="tabletext">
                <img src="html/images/Xion18x18.gif" alt="Angry face"
                                         name="delete" value="delete"/>
            </td>
        </form>
    </tr>

    <?php endif;?>
    <?php endforeach;?>
        
</table>
</div>


<div class="login-box">
    <div id="sideheader">Payoff Stats</div>
    <div id="sidecontent">
        <p title='Interest saved based on a 10 year loan compounded monthly. Meant for motivation only!'>
            $<?php echo ($paymentPerWeek); ?>
            <span class="sidebarpayment">
                Avg. Per Week
            </span>
            <br/>
            $<?php echo ($paymentPerMonth); ?>
            <span class="sidebarpayment">
                Avg. Per Month
            </span>
            <br/>
            <?php
                if($PayoffCalc->getPayoffDate()) {
                    echo $PayoffCalc->getPayoffDate();
                    $payOffDateText = "Payoff Date<br/>";
                }
            ?>
            <span class="sidebarpayment">
                <?php echo $payOffDateText;?>
            </span>
            $<?php
                $InterestSaved = $Factory->buildInterestSaved();
                $totalSaved = number_format($InterestSaved->getTotalInterestSaved());
                echo $totalSaved;
            ?>
            <span class="sidebarpayment">
                Estimated Interest Saved
            </span>
        </p>
        <a href='index.php?reset=true'>Reset</a> Stats

    </div>

</div>
<div class="login-boxprogbar">
    <?php include "html/progress_bar/ProgBar2.php"; ?>
</div>
</div>
</div>
<div class="footer"></div>
</div>
</body>
</html>